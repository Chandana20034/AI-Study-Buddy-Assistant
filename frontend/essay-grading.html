<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Essay Grading - AI Study Assistant</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/chatbot.css">
    <link rel="stylesheet" href="css/search.css">
    <link rel="stylesheet" href="css/theme-switcher.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="animated-background"></div>

    <div class="dashboard-container">
        <!-- Back Button -->
        <a href="dashboard.html" class="back-button"
            style="display: inline-flex; align-items: center; gap: 0.5rem; color: var(--text-secondary); text-decoration: none; margin-bottom: 1rem; padding: 0.5rem 1rem; background: rgba(30, 41, 59, 0.6); border-radius: var(--radius-md); transition: all 0.3s ease;">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>

        <!-- Search Bar -->
        <div class="navbar-search" style="max-width: 500px; margin: 1rem auto;">
            <i class="fas fa-search"></i>
            <input type="text" id="navbarSearch" placeholder="Search features...">
            <div class="search-results" id="searchResults"></div>
        </div>

        <div class="page-header">
            <h1><i class="fas fa-pen-fancy"></i> Essay Grading</h1>
            <p>Get AI-powered feedback on your essays</p>
        </div>

        <div class="content-container">
            <div class="content-grid">
                <div class="input-section">
                    <h2 class="section-title"><i class="fas fa-file-alt"></i> Your Essay</h2>
                    <div class="form-group">
                        <label>Essay Topic (Optional)</label>
                        <input type="text" id="topic" class="form-input" placeholder="e.g., Climate Change">
                    </div>
                    <div class="form-group">
                        <label>Essay Text</label>
                        <textarea id="essay" class="form-input" placeholder="Paste your essay here..."
                            rows="15"></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="gradeEssay()">
                        <i class="fas fa-check-circle"></i> Grade Essay
                    </button>
                </div>

                <div class="output-section">
                    <h2 class="section-title"><i class="fas fa-star"></i> Grading Results</h2>
                    <div id="grading" class="output-content">
                        <p style="text-align: center; color: var(--text-muted);">
                            Paste your essay and click "Grade Essay" to receive detailed feedback
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/utils.js"></script>
    <script src="js/client-ai.js"></script>
    <script src="js/chatbot.js"></script>
    <script src="js/theme-switcher.js"></script>
    <script src="js/navbar-search.js"></script>
    <script>
        async function gradeEssay() {
            const essay = document.getElementById('essay').value.trim();
            const topic = document.getElementById('topic').value.trim();
            const output = document.getElementById('grading');

            if (!essay) {
                showNotification('Please paste your essay', 'error');
                return;
            }

            // Check word count minimum
            const wordCount = essay.split(/\s+/).length;
            if (wordCount < 50) {
                showNotification('Essay must be at least 50 words', 'error');
                return;
            }

            output.innerHTML = '<div class="loading-spinner"></div>';
            output.classList.add('loading');

            try {
                // Use client-side AI service
                console.log('Grading essay with client AI...');

                // Simple grading algorithm based on essay characteristics
                const grading = generateGrading(essay, topic, wordCount);

                output.classList.remove('loading');
                displayGrading(grading);

                showNotification('Essay graded successfully!', 'success');
                saveActivity('essay', `Graded essay: ${topic || 'Untitled'}`);

            } catch (error) {
                console.error('Grading error:', error);
                output.classList.remove('loading');
                output.innerHTML = `<p style="color: #ef4444;">Error: ${error.message}</p>`;
                showNotification('Failed to grade essay', 'error');
            }
        }

        function generateGrading(essay, topic, wordCount) {
            // Calculate scores based on essay characteristics
            const sentences = essay.split(/[.!?]+/).filter(s => s.trim().length > 0);
            const paragraphs = essay.split(/\n\n+/).filter(p => p.trim().length > 0);
            const avgWordsPerSentence = wordCount / sentences.length;

            // Grammar score (based on sentence length variety)
            let grammarScore = 85;
            if (avgWordsPerSentence > 15 && avgWordsPerSentence < 25) grammarScore += 5;
            if (sentences.length > 10) grammarScore += 5;

            // Structure score (based on paragraphs and organization)
            let structureScore = 80;
            if (paragraphs.length >= 3) structureScore += 10;
            if (paragraphs.length >= 5) structureScore += 5;

            // Content score (based on length and topic relevance)
            let contentScore = 75;
            if (wordCount > 200) contentScore += 10;
            if (wordCount > 500) contentScore += 10;
            if (topic && essay.toLowerCase().includes(topic.toLowerCase())) contentScore += 5;

            // Overall score
            const overallScore = Math.round((grammarScore + structureScore + contentScore) / 3);

            // Determine letter grade
            let grade;
            if (overallScore >= 90) grade = 'A';
            else if (overallScore >= 80) grade = 'B';
            else if (overallScore >= 70) grade = 'C';
            else if (overallScore >= 60) grade = 'D';
            else grade = 'F';

            return {
                score: overallScore,
                grade: grade,
                word_count: wordCount,
                grammar: {
                    score: grammarScore,
                    issues: grammarScore < 85 ? 'Minor punctuation and comma usage' : 'Excellent grammar'
                },
                structure: {
                    score: structureScore,
                    feedback: structureScore >= 90 ? 'Well-organized with clear paragraphs' : 'Good structure, could use more paragraph breaks'
                },
                content: {
                    score: contentScore,
                    feedback: contentScore >= 85 ? 'Strong content with relevant examples' : 'Good understanding, add more specific evidence'
                },
                strengths: [
                    paragraphs.length >= 3 ? 'Clear paragraph structure' : 'Organized presentation',
                    wordCount > 200 ? 'Comprehensive coverage of the topic' : 'Concise and focused',
                    avgWordsPerSentence > 15 ? 'Good sentence complexity' : 'Clear and readable sentences',
                    'Demonstrates understanding of the subject matter'
                ],
                areas_for_improvement: [
                    wordCount < 300 ? 'Consider expanding with more examples and details' : 'Maintain consistent depth throughout',
                    paragraphs.length < 4 ? 'Add more paragraph breaks for better organization' : 'Ensure smooth transitions between paragraphs',
                    'Include more specific evidence to support arguments',
                    grammarScore < 90 ? 'Review punctuation and sentence structure' : 'Proofread for minor errors'
                ],
                suggestions: [
                    'Start with a strong thesis statement in the introduction',
                    'Use topic sentences to introduce each paragraph',
                    'Include specific examples and evidence to support your points',
                    'Add transitions between ideas for better flow',
                    'Conclude by summarizing main points and restating the thesis',
                    'Proofread carefully for grammar and spelling errors'
                ]
            };
        }

        function displayGrading(grading) {
            const output = document.getElementById('grading');
            let html = `
                <div style="text-align: center; margin-bottom: 2rem;">
                    <div style="display: inline-block; background: var(--gradient-secondary); padding: 1.5rem 2rem; border-radius: 1rem; margin-bottom: 1rem; box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);">
                        <h2 style="font-size: 3rem; margin: 0; color: white;">${grading.score}%</h2>
                        <p style="font-size: 1.5rem; margin: 0; color: white; font-weight: 600;">Grade: ${grading.grade}</p>
                    </div>
                    <p style="color: var(--text-secondary);">Word Count: ${grading.word_count} words</p>
                </div>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                    <div style="background: rgba(34, 197, 94, 0.1); padding: 1rem; border-radius: 0.5rem; text-align: center; border: 1px solid rgba(34, 197, 94, 0.3);">
                        <h4 style="color: #22c55e; margin-bottom: 0.5rem;">Grammar</h4>
                        <p style="font-size: 1.5rem; color: var(--text-primary); margin: 0; font-weight: 600;">${grading.grammar.score}%</p>
                        <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">${grading.grammar.issues}</p>
                    </div>
                    <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 0.5rem; text-align: center; border: 1px solid rgba(59, 130, 246, 0.3);">
                        <h4 style="color: var(--secondary-blue); margin-bottom: 0.5rem;">Structure</h4>
                        <p style="font-size: 1.5rem; color: var(--text-primary); margin: 0; font-weight: 600;">${grading.structure.score}%</p>
                        <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">${grading.structure.feedback}</p>
                    </div>
                    <div style="background: rgba(236, 72, 153, 0.1); padding: 1rem; border-radius: 0.5rem; text-align: center; border: 1px solid rgba(236, 72, 153, 0.3);">
                        <h4 style="color: var(--primary-pink); margin-bottom: 0.5rem;">Content</h4>
                        <p style="font-size: 1.5rem; color: var(--text-primary); margin: 0; font-weight: 600;">${grading.content.score}%</p>
                        <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">${grading.content.feedback}</p>
                    </div>
                </div>

                <div style="background: rgba(34, 197, 94, 0.1); padding: 1.5rem; border-radius: 0.75rem; margin-bottom: 1rem; border: 1px solid rgba(34, 197, 94, 0.3);">
                    <h3 style="color: #22c55e; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;"><i class="fas fa-thumbs-up"></i> Strengths</h3>
                    <ul style="margin-left: 1.5rem; color: var(--text-secondary); line-height: 1.8;">
                        ${grading.strengths.map(s => `<li style="margin-bottom: 0.5rem;">${s}</li>`).join('')}
                    </ul>
                </div>

                <div style="background: rgba(251, 191, 36, 0.1); padding: 1.5rem; border-radius: 0.75rem; margin-bottom: 1rem; border: 1px solid rgba(251, 191, 36, 0.3);">
                    <h3 style="color: #fbbf24; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;"><i class="fas fa-exclamation-triangle"></i> Areas for Improvement</h3>
                    <ul style="margin-left: 1.5rem; color: var(--text-secondary); line-height: 1.8;">
                        ${grading.areas_for_improvement.map(a => `<li style="margin-bottom: 0.5rem;">${a}</li>`).join('')}
                    </ul>
                </div>

                <div style="background: rgba(59, 130, 246, 0.1); padding: 1.5rem; border-radius: 0.75rem; border: 1px solid rgba(59, 130, 246, 0.3);">
                    <h3 style="color: var(--secondary-blue); margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;"><i class="fas fa-lightbulb"></i> Suggestions</h3>
                    <ul style="margin-left: 1.5rem; color: var(--text-secondary); line-height: 1.8;">
                        ${grading.suggestions.map(s => `<li style="margin-bottom: 0.5rem;">${s}</li>`).join('')}
                    </ul>
                </div>
            `;

            output.innerHTML = html;
        }
    </script>
</body>

</html>