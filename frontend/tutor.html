<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutor Me - AI Study Assistant</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/chatbot.css">
    <link rel="stylesheet" href="css/search.css">
    <link rel="stylesheet" href="css/theme-switcher.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
    <div class="animated-background"></div>

    <div class="dashboard-container">
        <!-- Back Button -->
        <a href="dashboard.html" class="back-button"
            style="display: inline-flex; align-items: center; gap: 0.5rem; color: var(--text-secondary); text-decoration: none; margin-bottom: 1rem; padding: 0.5rem 1rem; background: rgba(30, 41, 59, 0.6); border-radius: var(--radius-md); transition: all 0.3s ease;">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>

        <!-- Search Bar -->
        <div class="navbar-search" style="max-width: 500px; margin: 1rem auto;">
            <i class="fas fa-search"></i>
            <input type="text" id="navbarSearch" placeholder="Search features...">
            <div class="search-results" id="searchResults"></div>
        </div>

        <div class="page-header">
            <h1><i class="fas fa-chalkboard-teacher"></i> AI Tutor</h1>
            <p>Get step-by-step help with any problem</p>
        </div>

        <div class="content-container">
            <div class="content-grid">
                <div class="input-section">
                    <h2 class="section-title"><i class="fas fa-question"></i> Your Problem</h2>
                    <div class="form-group">
                        <label>Subject</label>
                        <select id="subject" class="form-input">
                            <option>Mathematics</option>
                            <option>Physics</option>
                            <option>Chemistry</option>
                            <option>Biology</option>
                            <option>Computer Science</option>
                            <option>English</option>
                            <option>History</option>
                            <option>General</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Problem or Question</label>
                        <textarea id="problem" class="form-input" placeholder="Enter your problem here..."
                            rows="8"></textarea>
                    </div>
                    <button class="btn btn-primary" onclick="getTutorHelp()">
                        <i class="fas fa-graduation-cap"></i> Get Help
                    </button>
                </div>

                <div class="output-section">
                    <h2 class="section-title"><i class="fas fa-lightbulb"></i> Solution</h2>
                    <div id="solution" class="output-content">
                        <p style="text-align: center; color: var(--text-muted);">
                            Enter a problem and click "Get Help" to see the step-by-step solution
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/client-ai.js"></script>
    <script src="js/chatbot.js"></script>
    <script src="js/theme-switcher.js"></script>
    <script src="js/navbar-search.js"></script>
    <script src="js/utils.js"></script>
    <script>
        const API_URL = 'http://localhost:5000/api';

        // Client-side intelligent tutoring fallback
        function getClientSideTutorResponse(problem, subject) {
            const problemLower = problem.toLowerCase();

            const responses = {
                "Computer Science": {
                    "study": {
                        steps: [
                            { step: 1, title: "Start with Fundamentals", explanation: "Begin with variables, data types, loops, and conditionals. Use freeCodeCamp, Codecademy, or Khan Academy." },
                            { step: 2, title: "Learn a Programming Language", explanation: "Choose Python (easy syntax) or JavaScript (web dev). Code daily, even 30 minutes helps!" },
                            { step: 3, title: "Practice Problem Solving", explanation: "Use LeetCode, HackerRank, or Codewars. Start easy, progress gradually." },
                            { step: 4, title: "Build Real Projects", explanation: "Create calculators, to-do apps, games. Projects solidify learning." },
                            { step: 5, title: "Learn DSA", explanation: "Study arrays, linked lists, trees, sorting algorithms. Essential for interviews!" }
                        ],
                        tips: ["Code daily - consistency beats intensity", "Type code yourself, don't just watch", "Read code on GitHub", "Join coding communities"],
                        answer: "Focus: Fundamentals → One language → Problem solving → Projects → DSA. 1-2 hours daily shows results in weeks!"
                    }
                },
                "Mathematics": {
                    "default": {
                        steps: [
                            { step: 1, title: "Identify Problem Type", explanation: "Is this algebra, calculus, geometry, or statistics? Each has specific methods." },
                            { step: 2, title: "List Known Values", explanation: "Write down all given information and what you need to find." },
                            { step: 3, title: "Apply Formulas", explanation: "Use appropriate mathematical formulas or theorems." },
                            { step: 4, title: "Solve Step by Step", explanation: "Work through calculations carefully, showing each step." },
                            { step: 5, title: "Verify Answer", explanation: "Plug answer back in or check if it makes logical sense." }
                        ],
                        tips: ["Practice similar problems", "Memorize key formulas", "Draw diagrams when helpful", "Check arithmetic twice"],
                        answer: "Follow the systematic approach above. For specific help, describe the exact equation."
                    }
                },
                "Physics": {
                    "default": {
                        steps: [
                            { step: 1, title: "Identify Physical Concepts", explanation: "Which principles apply: mechanics, thermodynamics, electromagnetism?" },
                            { step: 2, title: "Draw a Diagram", explanation: "Sketch the situation. Label forces, velocities, quantities." },
                            { step: 3, title: "Write Equations", explanation: "List relevant physics equations (F=ma, E=mc², etc.)." },
                            { step: 4, title: "Solve and Check Units", explanation: "Solve algebraically first, then plug in numbers. Verify units!" }
                        ],
                        tips: ["Units are crucial!", "Draw free-body diagrams", "Use conservation laws", "Estimate answers first"],
                        answer: "Identify the principle, visualize the scenario, then solve systematically."
                    }
                }
            };

            // Find matching response
            let subjectData = responses[subject] || responses["Mathematics"];
            let response;

            if (problemLower.includes("study") || problemLower.includes("how to")) {
                response = subjectData["study"] || subjectData["default"];
            } else {
                response = subjectData["default"] || subjectData["study"];
            }

            if (!response) {
                response = {
                    steps: [
                        { step: 1, title: "Analyze the Question", explanation: `Breaking down '${problem}' - identify key concepts.` },
                        { step: 2, title: "Apply Core Concepts", explanation: `For ${subject}, consider fundamental principles that apply.` },
                        { step: 3, title: "Work Through Solution", explanation: "Connect knowledge to question, find relationships." },
                        { step: 4, title: "Formulate Answer", explanation: "Organize thoughts and provide reasoned answer." }
                    ],
                    tips: ["Break problems into parts", "Review related notes", "Practice similar questions", "Ask for clarification"],
                    answer: `Apply ${subject} core concepts and think systematically.`
                };
            }

            return {
                problem: problem,
                subject: subject,
                steps: response.steps,
                tips: response.tips,
                answer: response.answer
            };
        }

        async function getTutorHelp() {
            const problem = document.getElementById('problem').value.trim();
            const subject = document.getElementById('subject').value;
            const output = document.getElementById('solution');

            if (!problem) {
                alert('Please enter a problem');
                return;
            }

            output.innerHTML = '<div class="loading-spinner"></div>';
            output.classList.add('loading');

            try {
                const response = await fetch(`${API_URL}/tutor`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ problem, subject })
                });

                const data = await response.json();
                output.classList.remove('loading');

                if (response.ok) {
                    displaySolution(data.solution);
                } else {
                    // Fallback to client-side if backend error
                    const fallback = getClientSideTutorResponse(problem, subject);
                    displaySolution(fallback);
                }
            } catch (error) {
                output.classList.remove('loading');
                // Fallback to client-side tutoring when server is not available
                const fallback = getClientSideTutorResponse(problem, subject);
                displaySolution(fallback);
            }
        }

        function displaySolution(solution) {
            const output = document.getElementById('solution');
            let html = `
                <div style="margin-bottom: 1.5rem;">
                    <h3 style="color: var(--secondary-blue); margin-bottom: 0.5rem;">
                        <i class="fas fa-book"></i> Subject: ${solution.subject}
                    </h3>
                    <p style="color: var(--text-secondary);">${solution.problem}</p>
                </div>

                <h3 style="color: var(--secondary-pink); margin-bottom: 1rem;">
                    <i class="fas fa-list-ol"></i> Step-by-Step Solution
                </h3>
            `;

            solution.steps.forEach(step => {
                html += `
                    <div style="background: rgba(59, 130, 246, 0.1); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; border-left: 3px solid var(--secondary-blue);">
                        <h4 style="color: var(--text-primary); margin-bottom: 0.5rem;">
                            Step ${step.step}: ${step.title}
                        </h4>
                        <p style="color: var(--text-secondary);">${step.explanation}</p>
                    </div>
                `;
            });

            html += `
                <div style="background: rgba(236, 72, 153, 0.1); padding: 1rem; border-radius: 0.5rem; margin-top: 1.5rem;">
                    <h4 style="color: var(--primary-pink); margin-bottom: 0.5rem;">
                        <i class="fas fa-lightbulb"></i> Study Tips
                    </h4>
                    <ul style="margin-left: 1.5rem; color: var(--text-secondary);">
                        ${solution.tips.map(tip => `<li style="margin-bottom: 0.5rem;">${tip}</li>`).join('')}
                    </ul>
                </div>

                <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(34, 197, 94, 0.1); border-radius: 0.5rem;">
                    <h4 style="color: #22c55e; margin-bottom: 0.5rem;">
                        <i class="fas fa-check-circle"></i> Answer
                    </h4>
                    <p style="color: var(--text-secondary);">${solution.answer}</p>
                </div>
            `;

            output.innerHTML = html;

            // Save to activity history
            if (typeof utils !== 'undefined' && utils.saveActivity) {
                utils.saveActivity('tutor', `Tutored: ${solution.subject} - ${solution.problem.substring(0, 50)}...`);
            }
        }
    </script>
</body>

</html>